---
/**
 * PropertyCarouselClic.astro - COPIA FIEL DEL ORIGINAL
 * 100% fiel al dise√±o de pa.clicinmobiliaria.com
 * Carrusel horizontal con navegaci√≥n de im√°genes m√∫ltiples
 * Adaptado al sistema de datos estructurados (frontend desacoplado)
 */

import type { ComponenteDataEstructurado } from '../../types/componentesEstructurado';

interface Props {
  datos: ComponenteDataEstructurado;
  tema?: Record<string, string>;
  baseUrl?: string;
}

const { datos, tema = {}, baseUrl = '' } = Astro.props;

const staticData = datos?.static_data || {};
const dynamicData = datos?.dynamic_data || {};
const styles = datos?.styles || {};

// === COLORES CONFIGURABLES ===
const colorPrimario = styles.colorPrimario || tema?.primary || '#f04e00';
const colorPrimarioHover = styles.colorPrimarioHover || tema?.primaryHover || '#d94400';
const colorTexto = styles.colorTexto || tema?.text || '#111827';
const colorTextoSecondary = styles.colorTextoSecondary || tema?.textSecondary || '#4b5563';
const colorTextoTertiary = styles.colorTextoTertiary || '#6b7280';
const colorFondo = styles.colorFondo || tema?.background || '#ffffff';
const colorBorde = styles.colorBorde || tema?.border || '#e5e7eb';
const colorFondoCard = styles.colorFondoCard || '#ffffff';
const colorSombra = styles.colorSombra || 'rgba(0, 0, 0, 0.1)';

// Configuraci√≥n
const title = staticData.titulo || 'Propiedades Destacadas';
const subtitle = staticData.subtitulo;
const viewAllLink = staticData.viewAllLink || '/propiedades';
const theme = staticData.theme || 'default';
const language = staticData.language || 'es';

// Datos din√°micos (propiedades)
const rawProperties = dynamicData?.resolved || [];
const properties = Array.isArray(rawProperties) ? rawProperties : [];

// Debug: Log para verificar datos recibidos
console.log('üè† [PropertyCarouselClic] Datos recibidos:', {
  hasDynamicData: !!dynamicData,
  rawPropertiesLength: rawProperties?.length || 0,
  propertiesLength: properties.length,
  staticData,
  dynamicData
});

// No renderizar si no hay propiedades
if (!properties || properties.length === 0) {
  console.warn('‚ö†Ô∏è [PropertyCarouselClic] No hay propiedades para mostrar, componente no se renderiza');
  return null;
}

// Traducciones - EXACTAS del original
const translations = {
  es: {
    viewAll: 'Ver todas',
    addToFavorites: 'Agregar a favoritos',
    previous: 'Anterior',
    next: 'Siguiente',
    reserve: 'Reserva',
    priceOnRequest: 'Precio a consultar',
    locationNotSpecified: 'Ubicaci√≥n no especificada',
    propertyWithoutName: 'Propiedad sin nombre',
    property: 'Propiedad'
  },
  en: {
    viewAll: 'View all',
    addToFavorites: 'Add to favorites',
    previous: 'Previous',
    next: 'Next',
    reserve: 'Reserve',
    priceOnRequest: 'Price on request',
    locationNotSpecified: 'Location not specified',
    propertyWithoutName: 'Property without name',
    property: 'Property'
  },
  fr: {
    viewAll: 'Voir tout',
    addToFavorites: 'Ajouter aux favoris',
    previous: 'Pr√©c√©dent',
    next: 'Suivant',
    reserve: 'R√©server',
    priceOnRequest: 'Prix sur demande',
    locationNotSpecified: 'Emplacement non sp√©cifi√©',
    propertyWithoutName: 'Propri√©t√© sans nom',
    property: 'Propri√©t√©'
  }
};

const t = translations[language] || translations.es;

// ID √∫nico para este carrusel
const carouselId = `carousel-${Math.random().toString(36).substr(2, 9)}`;

// Procesar propiedades - EXACTO del original
const processedProperties = properties.map((property: any, index: number) => ({
  ...property,
  id: property.id || `carousel-${index}`,
  titulo: property.titulo || property.title || t.propertyWithoutName,
  precio: property.precio || property.price || t.priceOnRequest,
  imagen: property.imagen || property.featured_image || 'https://via.placeholder.com/400x300/e5e7eb/9ca3af?text=Sin+Imagen',
  imagenes: property.imagenes || [property.imagen || property.featured_image || 'https://via.placeholder.com/400x300/e5e7eb/9ca3af?text=Sin+Imagen'],
  sector: property.sector || property.location || property.ubicacion || t.locationNotSpecified,
  habitaciones: property.habitaciones || property.bedrooms || 0,
  banos: property.banos || property.bathrooms || 0,
  metros: property.metros || property.built_area || property.area || 0,
  tipo: property.tipo || property.type || t.property,
  slug: property.slug || property.id,
  url: property.url || `${baseUrl}/propiedades/${property.slug || property.id}`
}));

console.log(`üè† [PropertyCarousel] Mostrando ${processedProperties.length} propiedades`);
---

<section 
  class="property-carousel-clic py-8"
  style={`
    --pc-primary: ${colorPrimario};
    --pc-primary-hover: ${colorPrimarioHover};
    --pc-text: ${colorTexto};
    --pc-text-secondary: ${colorTextoSecondary};
    --pc-text-tertiary: ${colorTextoTertiary};
    --pc-bg: ${colorFondo};
    --pc-border: ${colorBorde};
    --pc-card-bg: ${colorFondoCard};
    --pc-shadow: ${colorSombra};
    background-color: var(--pc-bg);
  `}
>
  <div class="carousel-container">
    {/* Header - EXACTO del original */}
    <div class="carousel-header">
      <div class="carousel-header-left">
        <h3 class="carousel-title">{title}</h3>
        {subtitle && (
          <p class="carousel-subtitle">{subtitle}</p>
        )}
      </div>
      {viewAllLink && (
        <div class="carousel-header-right">
          <a
            href={viewAllLink}
            class="carousel-view-all"
          >
            <span class="text-sm leading-tight">
              {t.viewAll}
            </span>
            <svg class="carousel-view-all-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
      )}
    </div>

    {/* Carrusel Container - EXACTO del original */}
    <div class="carousel-container-wrapper">
      {/* Botones de navegaci√≥n - EXACTO del original */}
      <button
        class="carousel-nav-prev"
        aria-label={t.previous}
        type="button"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      <button
        class="carousel-nav-next"
        aria-label={t.next}
        type="button"
      >
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>

      {/* Carrusel - EXACTO del original */}
      <div class="carousel-wrapper-overflow">
        <div class="carousel-track-flex" id={carouselId}>
          {processedProperties.map((property, index) => {
            const propertyImages = property.imagenes || [property.imagen];
            const hasMultipleImages = propertyImages.length > 1;
            const imageCarouselId = `${carouselId}-img-${index}`;

            return (
              <article class="carousel-item-card">
                <a
                  href={property.url}
                  class="group cursor-pointer block"
                  data-property-id={property.id}
                >
                  <div class="property-card">
                    {/* Imagen con carousel - EXACTO del original */}
                    <div class="property-image-container">
                      {/* Contenedor de im√°genes */}
                      <div
                        class="image-carousel-container"
                        data-image-carousel={imageCarouselId}
                      >
                        {propertyImages.map((img, imgIndex) => (
                          <img
                            src={img || 'https://via.placeholder.com/400x300/e5e7eb/9ca3af?text=Sin+Imagen'}
                            alt={`${property.titulo} - Imagen ${imgIndex + 1}`}
                            class={`image-slide absolute inset-0 w-full h-full object-cover transition-all duration-300 ${imgIndex === 0 ? 'opacity-100 scale-100' : 'opacity-0 scale-105'}`}
                            data-slide-index={imgIndex}
                            data-image-carousel={imageCarouselId}
                            loading="lazy"
                            onerror="this.src='https://via.placeholder.com/400x300/e5e7eb/9ca3af?text=Sin+Imagen';"
                          />
                        ))}
                      </div>

                      {/* Controles de navegaci√≥n de im√°genes - EXACTO del original */}
                      {hasMultipleImages && (
                        <div class="image-controls">
                          <button
                            class="image-prev-btn"
                            data-image-carousel={imageCarouselId}
                            data-direction="prev"
                            type="button"
                            aria-label={t.previous}
                          >
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path>
                            </svg>
                          </button>

                          <button
                            class="image-next-btn"
                            data-image-carousel={imageCarouselId}
                            data-direction="next"
                            type="button"
                            aria-label={t.next}
                          >
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path>
                            </svg>
                          </button>
                        </div>
                      )}

                      {/* Indicadores de imagen - EXACTO del original */}
                      {hasMultipleImages && (
                        <div class="image-dots-container">
                          {propertyImages.map((_, dotIndex) => (
                            <div
                              class={`image-dot ${dotIndex === 0 ? 'image-dot-active' : 'image-dot-inactive'}`}
                              data-image-carousel={imageCarouselId}
                              data-dot-index={dotIndex}
                            ></div>
                          ))}
                        </div>
                      )}

                      {/* Badge de tipo - EXACTO del original */}
                      {property.is_project && property.reserva_desde ? (
                        <span class="property-badge property-badge-dark">
                          {t.reserve} {property.reserva_desde}
                        </span>
                      ) : property.tipo && property.tipo !== t.property && (
                        <span class="property-badge property-badge-light">
                          {property.tipo}
                        </span>
                      )}

                      {/* Bot√≥n de favoritos - EXACTO del original */}
                      <button
                        class="property-favorite-btn"
                        aria-label={t.addToFavorites}
                        onclick={`event.preventDefault(); event.stopPropagation(); toggleCarouselFavorite('${property.id}', '${property.titulo.replace(/'/g, "\\'")}');`}
                        data-favorite-id={property.id}
                      >
                        <svg class="w-4 h-4 text-gray-600 hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                      </button>
                    </div>

                    {/* Contenido - EXACTO del original */}
                    <div class="property-content">
                      {/* Precio y c√≥digo */}
                      <div class="property-price-row">
                        <div class="property-price text-lg font-bold">
                          {property.precio}
                        </div>
                        {property.code && (
                          <div class="property-code text-xs font-mono">
                            #{property.code}
                          </div>
                        )}
                      </div>

                      {/* Ubicaci√≥n */}
                      <div class="property-location-row">
                        <svg class="location-icon w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <p class="property-location text-xs truncate">{property.sector}</p>
                      </div>

                      {/* T√≠tulo */}
                      <div class="property-title-row">
                        <h4 class="property-title font-medium line-clamp-2 transition-colors leading-tight text-sm">
                          {property.titulo}
                        </h4>
                      </div>

                      {/* Caracter√≠sticas - EXACTO del original */}
                      <div class="property-features-row">
                        {(property.bedrooms > 0 || property.habitaciones > 0 || (property.is_project && property.habitaciones_rango && !property.habitaciones_rango.includes('0') && property.habitaciones_rango.trim() !== '0')) && (
                          <span class="property-feature-item">
                            <i class="fas fa-bed property-feature-icon"></i>
                            <span class="font-semibold">
                              {property.is_project && property.habitaciones_rango ?
                                property.habitaciones_rango.replace(/\s*(hab|habitaciones?)\s*/gi, '').trim() :
                                property.bedrooms || property.habitaciones
                              }
                            </span>
                          </span>
                        )}

                        {(property.bathrooms > 0 || property.banos > 0 || (property.is_project && property.banos_rango && !property.banos_rango.includes('0') && property.banos_rango.trim() !== '0')) && (
                          <span class="property-feature-item">
                            <i class="fas fa-bath property-feature-icon"></i>
                            <span class="font-semibold">
                              {property.is_project && property.banos_rango ?
                                property.banos_rango.replace(/\s*(ba√±os?|bath|bathroom)\s*/gi, '').trim() :
                                property.bathrooms || property.banos
                              }
                            </span>
                          </span>
                        )}

                        {((property.built_area > 0) || (property.land_area > 0) || (property.metros > 0) || (property.metros_terreno > 0) || (property.is_project && property.metros_rango && !property.metros_rango.includes('0') && property.metros_rango.trim() !== '0')) && (
                          <span class="property-feature-item">
                            <i class="fas fa-th-large property-feature-icon"></i>
                            <span class="font-semibold">
                              {property.is_project && property.metros_rango ?
                                property.metros_rango.replace(/\s*m¬≤?\s*/gi, '').trim() + 'm¬≤' :
                                property.built_area > 0 ? `${property.built_area}m¬≤` :
                                property.land_area > 0 ? `${property.land_area}m¬≤` :
                                property.metros_terreno > 0 ? `${property.metros_terreno}m¬≤` :
                                property.metros > 0 ? `${property.metros}m¬≤` : ''
                              }
                            </span>
                          </span>
                        )}

                        {(property.parking_spots > 0 || property.parqueos > 0) && (
                          <span class="property-feature-item">
                            <i class="fas fa-car property-feature-icon"></i>
                            <span class="font-semibold">
                              {property.parking_spots || property.parqueos}
                            </span>
                          </span>
                        )}
                      </div>
                    </div>
                  </div>
                </a>
              </article>
            );
          })}
        </div>
      </div>
    </div>

    {/* Ver todas m√≥vil - EXACTO del original */}
    {viewAllLink && (
      <div class="mt-6 text-center md:hidden">
        <a
          href={viewAllLink}
          class="carousel-view-all-mobile inline-flex items-start gap-2 font-medium"
        >
          <span class="text-sm leading-tight">
            {t.viewAll}
          </span>
          <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    )}
  </div>
</section>

<script define:vars={{ carouselId }}>
  // Script de carrusel - EXACTO del original
  document.addEventListener('DOMContentLoaded', () => {
    console.log('Inicializando PropertyCarousel:', carouselId);

    // ===== CARRUSEL PRINCIPAL (NAVEGACI√ìN ENTRE TARJETAS) =====
    const carousel = document.getElementById(carouselId);
    if (!carousel) {
      console.error('Carousel no encontrado:', carouselId);
      return;
    }

    const carouselContainer = carousel.parentElement.parentElement;
    const prevBtn = carouselContainer.querySelector('.carousel-nav-prev');
    const nextBtn = carouselContainer.querySelector('.carousel-nav-next');

    if (!prevBtn || !nextBtn) {
      console.error('Botones de navegaci√≥n no encontrados');
      return;
    }

    let currentIndex = 0;
    const items = carousel.children;
    const itemWidth = 288 + 16;
    const containerWidth = carousel.parentElement.offsetWidth;
    const visibleItems = Math.floor(containerWidth / itemWidth);
    const maxIndex = Math.max(0, items.length - visibleItems);

    function updateMainCarousel() {
      const translateX = currentIndex * itemWidth;
      carousel.style.transform = `translateX(-${translateX}px)`;

      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex >= maxIndex;

      prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
      nextBtn.style.opacity = currentIndex >= maxIndex ? '0.5' : '1';
    }

    prevBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (currentIndex > 0) {
        currentIndex--;
        updateMainCarousel();
      }
    });

    nextBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (currentIndex < maxIndex) {
        currentIndex++;
        updateMainCarousel();
      }
    });

    updateMainCarousel();

    // ===== CARRUSELES DE IM√ÅGENES =====
    const imageStates = new Map();

    function initImageCarousels() {
      const imageContainers = carousel.querySelectorAll('.image-carousel-container');

      imageContainers.forEach(container => {
        const carouselId = container.getAttribute('data-image-carousel');
        if (!carouselId) return;

        imageStates.set(carouselId, 0);

        const prevButton = container.parentElement.querySelector('.image-prev-btn');
        const nextButton = container.parentElement.querySelector('.image-next-btn');

        if (prevButton && nextButton) {
          prevButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            navigateImages(carouselId, 'prev');
          });

          nextButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            navigateImages(carouselId, 'next');
          });
        }
      });
    }

    function navigateImages(imageCarouselId, direction) {
      const images = document.querySelectorAll(`[data-image-carousel="${imageCarouselId}"].image-slide`);
      const dots = document.querySelectorAll(`[data-image-carousel="${imageCarouselId}"][data-dot-index]`);

      if (images.length <= 1) return;

      let currentImageIndex = imageStates.get(imageCarouselId) || 0;

      if (direction === 'next') {
        currentImageIndex = (currentImageIndex + 1) % images.length;
      } else {
        currentImageIndex = currentImageIndex === 0 ? images.length - 1 : currentImageIndex - 1;
      }

      imageStates.set(imageCarouselId, currentImageIndex);

      images.forEach((img, index) => {
        if (index === currentImageIndex) {
          img.style.opacity = '1';
          img.style.transform = 'scale(1)';
        } else {
          img.style.opacity = '0';
          img.style.transform = 'scale(1.05)';
        }
      });

      dots.forEach((dot, index) => {
        if (index === currentImageIndex) {
          dot.className = dot.className.replace('bg-white/40', 'bg-white/90');
        } else {
          dot.className = dot.className.replace('bg-white/90', 'bg-white/40');
        }
      });
    }

    initImageCarousels();

    // ===== FUNCIONES DE FAVORITOS =====
    async function toggleCarouselFavorite(propertyId, propertyTitle) {
      if (!window.simpleFavoritesManager) return;

      try {
        const isCurrentlyFavorite = window.simpleFavoritesManager.isFavorite(propertyId);
        updateCarouselFavoriteButtonUI(propertyId, !isCurrentlyFavorite);
        await window.simpleFavoritesManager.toggleFavorite(propertyId);
      } catch (error) {
        console.error('Error toggling favorite:', error);
        const currentState = window.simpleFavoritesManager.isFavorite(propertyId);
        updateCarouselFavoriteButtonUI(propertyId, currentState);
        alert('Error al actualizar favorito. Int√©ntalo de nuevo.');
      }
    }

    function updateCarouselFavoriteButtonUI(propertyId, isFavorite) {
      const button = carousel.querySelector(`[data-favorite-id="${propertyId}"]`);
      if (!button) return;

      const icon = button.querySelector('svg');
      if (!icon) return;

      if (isFavorite) {
        icon.setAttribute('fill', 'currentColor');
        icon.classList.remove('text-gray-600');
        icon.classList.add('text-red-500');
      } else {
        icon.setAttribute('fill', 'none');
        icon.classList.remove('text-red-500');
        icon.classList.add('text-gray-600');
      }
    }

    function updateCarouselFavoritesUI(info) {
      if (!info || !info.favorites) return;

      const favoritesSet = new Set(info.favorites);

      carousel.querySelectorAll('[data-favorite-id]').forEach(button => {
        const propertyId = button.getAttribute('data-favorite-id');
        const isFavorite = favoritesSet.has(propertyId);
        updateCarouselFavoriteButtonUI(propertyId, isFavorite);
      });
    }

    async function initializeCarouselFavorites() {
      try {
        let attempts = 0;
        const maxAttempts = 50;

        while (!window.simpleFavoritesManager && attempts < maxAttempts) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }

        if (window.simpleFavoritesManager) {
          const info = window.simpleFavoritesManager.getDeviceInfo();
          if (info && info.count > 0) {
            updateCarouselFavoritesUI(info);
          }

          window.simpleFavoritesManager.addListener(updateCarouselFavoritesUI);
        }
      } catch (error) {
        console.error('Error conectando carrusel con SimpleFavoritesManager:', error);
      }
    }

    initializeCarouselFavorites();
    window.toggleCarouselFavorite = toggleCarouselFavorite;
  });
</script>

<style>
  .property-carousel-clic {
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, sans-serif;
    padding: 3rem 0;
    width: 100%;
    display: flex;
    justify-content: center;
    background-color: var(--pc-bg);
  }

  .property-carousel-clic .carousel-container {
    width: 100%;
    max-width: 1280px; /* max-w-7xl */
    margin-left: auto;
    margin-right: auto;
    padding-left: 1rem;
    padding-right: 1rem;
    box-sizing: border-box;
  }

  @media (min-width: 640px) {
    .property-carousel-clic .carousel-container {
      max-width: 640px;
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }
  }

  @media (min-width: 768px) {
    .property-carousel-clic .carousel-container {
      max-width: 768px;
      padding-left: 2rem;
      padding-right: 2rem;
    }
  }

  @media (min-width: 1024px) {
    .property-carousel-clic .carousel-container {
      max-width: 1024px;
    }
  }

  @media (min-width: 1280px) {
    .property-carousel-clic .carousel-container {
      max-width: 1280px;
    }
  }

  .carousel-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 2rem;
    gap: 1.5rem;
    width: 100%;
    max-width: 100%;
  }

  .carousel-header-left {
    flex: 1;
  }

  .carousel-header-right {
    display: none;
  }

  @media (min-width: 768px) {
    .carousel-header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
  }

  .carousel-title {
    font-size: 1.5rem;
    font-weight: 700;
  }

  @media (min-width: 768px) {
    .carousel-title {
      font-size: 1.875rem;
    }
  }

  .carousel-subtitle {
    margin-top: 0.5rem;
  }

  .carousel-view-all {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    font-weight: 500;
    transition: color 0.2s;
    text-align: right;
    line-height: 1.25;
    max-width: 20rem;
  }

  .carousel-view-all-icon {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    margin-top: 0.125rem;
  }

  /* Ver todas m√≥vil */
  .carousel-view-all-mobile-container {
    margin-top: 1.5rem;
    text-align: center;
  }

  @media (min-width: 768px) {
    .carousel-view-all-mobile-container {
      display: none;
    }
  }

  .carousel-view-all-mobile {
    display: inline-flex;
    align-items: flex-start;
    gap: 0.5rem;
    font-weight: 500;
    color: var(--pc-primary);
  }

  .carousel-view-all-mobile:hover {
    color: var(--pc-primary-hover);
  }

  .carousel-view-all-mobile-text {
    font-size: 0.875rem;
    line-height: 1.25;
  }

  .carousel-view-all-mobile-icon {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
    margin-top: 0.125rem;
  }

  .carousel-title {
    color: var(--pc-text);
  }

  .carousel-subtitle {
    color: var(--pc-text-secondary);
  }

  .carousel-view-all,
  .carousel-view-all-mobile {
    color: var(--pc-primary);
  }

  .carousel-view-all:hover,
  .carousel-view-all-mobile:hover {
    color: var(--pc-primary-hover);
  }

  .property-price {
    color: var(--pc-primary);
  }

  .property-code {
    color: var(--pc-text-tertiary);
  }

  .location-icon {
    color: var(--pc-text-tertiary);
  }

  .property-location {
    color: var(--pc-text-secondary);
  }

  .property-title {
    color: var(--pc-text);
  }

  .group:hover .property-title {
    color: var(--pc-primary);
  }

  .property-feature-icon {
    color: var(--pc-primary);
  }

  /* Property Card */
  .property-card {
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    border: 1px solid #f3f4f6;
    overflow: hidden;
    transition: all 0.2s;
    display: block;
    width: 100%;
    height: auto;
  }

  .property-card:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    transform: translateY(-0.25rem);
  }

  /* Property Image Container */
  .property-image-container {
    position: relative;
    aspect-ratio: 4 / 2.8;
    overflow: hidden;
    background: #e5e7eb;
    width: 100%;
  }

  .image-carousel-container {
    width: 100%;
    height: 100%;
    position: relative;
  }

  .image-slide {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Image Controls */
  .image-controls {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  .group:hover .image-controls {
    opacity: 1;
    pointer-events: all;
  }

  .image-prev-btn,
  .image-next-btn {
    width: 2rem;
    height: 2rem;
    border-radius: 9999px;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    z-index: 20;
    border: none;
    cursor: pointer;
  }

  .image-prev-btn:hover,
  .image-next-btn:hover {
    background: rgba(0, 0, 0, 0.7);
  }

  .image-prev-btn svg,
  .image-next-btn svg {
    width: 1rem;
    height: 1rem;
    color: white;
  }

  /* Image Dots */
  .image-dots-container {
    position: absolute;
    bottom: 0.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.25rem;
  }

  .image-dot {
    width: 0.375rem;
    height: 0.375rem;
    border-radius: 9999px;
    transition: all 0.2s;
  }

  .image-dot-active {
    background: rgba(255, 255, 255, 0.9);
  }

  .image-dot-inactive {
    background: rgba(255, 255, 255, 0.4);
  }

  /* Property Favorite Button */
  .property-favorite-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.375rem;
    border-radius: 9999px;
    background: rgba(255, 255, 255, 0.9);
    transition: background 0.2s;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    z-index: 20;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .property-favorite-btn:hover {
    background: white;
  }

  .property-favorite-btn svg {
    width: 1rem;
    height: 1rem;
    color: #4b5563;
    transition: color 0.2s;
  }

  .property-favorite-btn:hover svg {
    color: #ef4444;
  }

  /* Property Content */
  .property-content {
    padding: 0.75rem;
  }

  .property-price-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
  }

  .property-location-row {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
  }

  .property-title-row {
    height: 2rem;
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .property-features-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--pc-text);
  }

  .property-feature-item {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .property-feature-icon {
    font-size: 0.875rem;
    width: 1em;
    height: 1em;
    display: inline-block;
  }

  /* Property Badges */
  .property-badge {
    position: absolute;
    top: 0.5rem;
    left: 0.5rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    z-index: 10;
  }

  .property-badge-dark {
    background: rgba(55, 65, 81, 0.9);
    color: white;
  }

  .property-badge-light {
    background: rgba(255, 255, 255, 0.9);
    color: #374151;
  }

  /* Carrusel Container - Asegurar que funcione sin Tailwind */
  .carousel-container-wrapper {
    position: relative;
    padding: 0 3rem;
    width: 100%;
    height: auto;
    min-height: 0;
    max-height: none;
    overflow: visible;
    display: block;
    box-sizing: border-box;
  }

  @media (max-width: 1024px) {
    .carousel-container-wrapper {
      padding: 0 2.5rem;
    }
  }

  .carousel-wrapper-overflow {
    overflow: hidden;
    width: 100%;
    height: auto;
    min-height: 0;
    position: relative;
  }

  .carousel-track-flex {
    display: flex;
    gap: 1rem;
    transition: transform 0.3s ease;
    width: max-content;
    flex-wrap: nowrap;
    height: auto;
    min-height: 0;
    align-items: stretch;
    justify-content: flex-start;
    margin: 0 auto;
  }

  .carousel-item-card {
    flex: 0 0 288px !important; /* w-72 = 18rem = 288px */
    width: 288px !important;
    min-width: 288px !important;
    max-width: 288px !important;
    box-sizing: border-box;
    height: auto;
    display: block;
  }

  /* Botones de navegaci√≥n */
  .carousel-nav-prev,
  .carousel-nav-next {
    position: absolute !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    z-index: 30;
    width: 3rem !important;
    height: 3rem !important;
    min-width: 3rem !important;
    max-width: 3rem !important;
    min-height: 3rem !important;
    max-height: 3rem !important;
    background: white;
    border-radius: 9999px;
    border: 1px solid #e5e7eb;
    display: flex !important;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    padding: 0 !important;
    margin: 0 !important;
    box-sizing: border-box !important;
    overflow: hidden;
    flex-shrink: 0;
    flex-grow: 0;
  }

  .carousel-nav-prev:hover,
  .carousel-nav-next:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    transform: translateY(-50%) scale(1.05);
  }

  .carousel-nav-prev {
    left: -0.5rem;
  }

  .carousel-nav-next {
    right: -0.5rem;
  }

  .carousel-nav-prev svg,
  .carousel-nav-next svg {
    width: 1.5rem !important;
    height: 1.5rem !important;
    min-width: 1.5rem !important;
    max-width: 1.5rem !important;
    min-height: 1.5rem !important;
    max-height: 1.5rem !important;
    color: #374151;
    display: block !important;
    flex-shrink: 0;
    flex-grow: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .carousel-container-wrapper {
      padding: 0 2rem;
    }

    .carousel-item-card {
      flex: 0 0 260px;
      width: 260px;
      min-width: 260px;
      max-width: 260px;
    }

    .carousel-nav-prev {
      left: 0;
    }

    .carousel-nav-next {
      right: 0;
    }
  }

  @media (max-width: 480px) {
    .carousel-container-wrapper {
      padding: 0 1rem;
    }

    .carousel-item-card {
      flex: 0 0 240px;
      width: 240px;
      min-width: 240px;
      max-width: 240px;
    }

    .carousel-nav-prev,
    .carousel-nav-next {
      width: 2.5rem;
      height: 2.5rem;
    }
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .image-slide {
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
  }

  .image-controls {
    transition: opacity 0.2s ease-in-out;
  }
</style>
