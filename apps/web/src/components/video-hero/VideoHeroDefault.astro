---
/**
 * VideoHeroDefault.astro
 * Hero para secci√≥n de videos con estad√≠sticas, categor√≠as y buscador
 */

import type { ComponenteDataEstructurado } from '../../types/componentesEstructurado';

interface Props {
  datos: ComponenteDataEstructurado;
  tema?: Record<string, string>;
  baseUrl?: string;
}

const { datos, tema = {}, baseUrl = '' } = Astro.props;

const staticData = datos?.static_data || {};
const dynamicData = datos?.dynamic_data || {};
const styles = datos?.styles || {};
const toggles = datos?.toggles || {};

// Datos est√°ticos
const titulo = staticData.titulo || 'Galer√≠a de Videos';
const subtitulo = staticData.subtitulo || 'Descubre nuestro contenido exclusivo';
const mostrarBuscador = toggles.mostrarBuscador !== false;
const mostrarEstadisticas = toggles.mostrarEstadisticas !== false;
const mostrarCategorias = toggles.mostrarCategorias !== false;

// Datos din√°micos
const categorias = dynamicData?.categorias || dynamicData?.resolved || [];
const stats = dynamicData?.stats || {};

// Mapeo de iconos texto a emoji
const iconoMap: Record<string, string> = {
  'video': 'üé¨',
  'play': '‚ñ∂Ô∏è',
  'film': 'üéûÔ∏è',
  'camera': 'üìπ',
  'youtube': 'üì∫',
  'tv': 'üì∫',
  'star': '‚≠ê',
  'heart': '‚ù§Ô∏è',
  'home': 'üè†',
  'building': 'üè¢',
  'key': 'üîë',
  'search': 'üîç',
  'trending-up': 'üìà',
  'dollar-sign': 'üí∞',
  'users': 'üë•',
  'book': 'üìö',
  'lightbulb': 'üí°',
  'map': 'üó∫Ô∏è',
  'default': 'üé¨'
};

function getIcono(icono: string | undefined): string {
  if (!icono) return '';
  // Si ya es un emoji, devolverlo tal cual
  if (/[\u{1F300}-\u{1F9FF}]/u.test(icono)) return icono;
  // Si es texto, buscar en el mapeo
  return iconoMap[icono.toLowerCase()] || iconoMap['default'];
}

// Calcular totalVideos sumando total_items de cada categor√≠a si no hay stats
let totalVideos = stats.totalVideos || (dynamicData as any)?.totalVideos || 0;
if (totalVideos === 0 && categorias.length > 0) {
  totalVideos = categorias.reduce((sum: number, cat: any) => sum + (cat.total_items || 0), 0);
}

const totalVistas = stats.totalVistas || (dynamicData as any)?.totalVistas || 0;
const totalCategorias = categorias.length || stats.totalCategorias || 0;

// Colores
const primaryColor = tema.primary || '#667eea';
const bgColor = styles.colors?.background || `linear-gradient(135deg, ${primaryColor} 0%, #764ba2 100%)`;
---

<section class="video-hero" style={`background: ${bgColor};`}>
  <div class="container">
    <div class="content">
      <h1 class="title">{titulo}</h1>
      <p class="subtitle">{subtitulo}</p>

      {mostrarEstadisticas && (
        <div class="stats">
          <div class="stat">
            <span class="stat-value">{totalVideos}</span>
            <span class="stat-label">Videos</span>
          </div>
          <div class="divider"></div>
          <div class="stat">
            <span class="stat-value">{totalCategorias}</span>
            <span class="stat-label">Categor√≠as</span>
          </div>
          {totalVistas > 0 && (
            <>
              <div class="divider"></div>
              <div class="stat">
                <span class="stat-value">{totalVistas.toLocaleString()}</span>
                <span class="stat-label">Vistas</span>
              </div>
            </>
          )}
        </div>
      )}

      {mostrarBuscador && (
        <form action={`${baseUrl}/videos`} method="GET" class="search-form">
          <div class="search-box">
            <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input type="text" name="q" placeholder="Buscar videos..." class="search-input" />
            <button type="submit" class="search-btn">Buscar</button>
          </div>
        </form>
      )}
    </div>

    {mostrarCategorias && categorias.length > 0 && (
      <div class="categories">
        <h3 class="categories-title">Explora por categor√≠a</h3>
        <div class="categories-list">
          {categorias.map((cat: any) => {
            const icono = getIcono(cat.icono);
            return (
              <a href={`${baseUrl}/videos/${cat.slug}`} class="category-pill">
                {icono && <span class="category-icon">{icono}</span>}
                <span>{cat.nombre}</span>
              </a>
            );
          })}
        </div>
      </div>
    )}
  </div>
</section>

<style>
  .video-hero {
    padding: 4rem 1rem;
    color: white;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .content {
    text-align: center;
    margin-bottom: 2rem;
  }

  .title {
    font-size: 2.5rem;
    font-weight: 800;
    margin: 0 0 1rem;
  }

  .subtitle {
    font-size: 1.125rem;
    opacity: 0.9;
    margin: 0 0 2rem;
  }

  .stats {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat {
    text-align: center;
  }

  .stat-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
  }

  .stat-label {
    font-size: 0.875rem;
    opacity: 0.8;
    text-transform: uppercase;
  }

  .divider {
    width: 1px;
    background: rgba(255,255,255,0.3);
  }

  .search-form {
    max-width: 500px;
    margin: 0 auto;
  }

  .search-box {
    display: flex;
    background: white;
    border-radius: 50px;
    padding: 0.25rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  }

  .search-icon {
    width: 20px;
    height: 20px;
    margin: auto 0.75rem;
    color: #718096;
  }

  .search-input {
    flex: 1;
    border: none;
    outline: none;
    padding: 0.75rem 0;
    font-size: 1rem;
    color: #1a202c;
  }

  .search-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
  }

  .categories {
    margin-top: 2rem;
  }

  .categories-title {
    text-align: center;
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 1rem;
    opacity: 0.9;
  }

  .categories-list {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .category-pill {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255,255,255,0.15);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    color: white;
    text-decoration: none;
    font-weight: 500;
    transition: background 0.2s;
  }

  .category-pill:hover {
    background: rgba(255,255,255,0.25);
  }

  @media (min-width: 768px) {
    .title { font-size: 3rem; }
  }
</style>
