---
/**
 * ArticleGridDefault.astro
 * Grid de articulos/blog con datos dinamicos desde la API
 * Muestra los articulos disponibles o un mensaje si no hay
 */

interface Props {
  datos?: any;
  tema?: Record<string, string>;
  baseUrl?: string;
  tipoPagina?: string;
}

const { datos, tema = {}, baseUrl = '', tipoPagina = '' } = Astro.props;

const staticData = datos?.static_data || {};
const toggles = datos?.toggles || {};
const dynamicData = datos?.dynamic_data || {};

// Datos estaticos del componente
const titulo = staticData?.titulo || 'Articulos Recientes';
const subtitulo = staticData?.subtitulo || '';

// Toggles
const mostrarAutor = toggles?.mostrarAutor ?? true;
const mostrarFecha = toggles?.mostrarFecha ?? true;
const mostrarExcerpt = toggles?.mostrarExcerpt ?? true;
const mostrarCategoria = toggles?.mostrarCategoria ?? true;

// Articulos dinamicos (vendran desde la API)
const articulos = dynamicData?.resolved || datos?.articulos || [];

// Colores del tema
const primaryColor = tema?.primary || '#667eea';
const secondaryColor = tema?.secondary || '#764ba2';

// Funcion para formatear fecha
function formatDate(dateString: string): string {
  if (!dateString) return '';
  try {
    const date = new Date(dateString);
    return date.toLocaleDateString('es-ES', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  } catch {
    return dateString;
  }
}
---

<section class="article-grid-section" style={`--primary: ${primaryColor}; --secondary: ${secondaryColor};`}>
  <div class="article-grid-container">
    <div class="section-header">
      <h2 class="section-title">{titulo}</h2>
      {subtitulo && <p class="section-subtitle">{subtitulo}</p>}
    </div>

    {articulos.length > 0 ? (
      <div class="articles-grid">
        {articulos.map((articulo: any, index: number) => {
          const categoriaSlug = articulo.categoria_slug || 'general';
          const articuloSlug = articulo.slug || articulo.id;
          const url = `${baseUrl}/articulos/${categoriaSlug}/${articuloSlug}`;
          const isFeatured = index === 0;
          const imagenSrc = articulo.imagen_principal || articulo.imagen || articulo.imagen_portada || articulo.featuredImage || articulo.thumbnail_url || '';
          const tituloArticulo = articulo.titulo || articulo.title || 'Articulo sin titulo';
          const autorNombre = articulo.autor || articulo.autor_nombre || '';
          const fechaPub = articulo.fecha_publicacion || '';
          const excerptTexto = articulo.excerpt || articulo.extracto || articulo.resumen || '';
          const categoriaNombre = articulo.categoria || articulo.categoria_nombre || '';

          return (
            <a href={url} class={`article-card ${isFeatured ? 'featured' : ''}`}>
              <div class="article-image">
                {imagenSrc ? (
                  <img src={imagenSrc} alt={tituloArticulo} loading="lazy" />
                ) : (
                  <div class="no-image">
                    <span class="placeholder-icon">A</span>
                  </div>
                )}
                {mostrarCategoria && categoriaNombre && (
                  <span class="article-category">{categoriaNombre}</span>
                )}
              </div>
              <div class="article-content">
                <div class="article-meta">
                  {mostrarFecha && fechaPub && (
                    <span class="article-date">{formatDate(fechaPub)}</span>
                  )}
                  {mostrarAutor && autorNombre && (
                    <span class="article-author">{autorNombre}</span>
                  )}
                </div>
                <h3 class="article-title">{tituloArticulo}</h3>
                {mostrarExcerpt && excerptTexto && (
                  <p class="article-excerpt">{excerptTexto}</p>
                )}
                <span class="read-more">Leer mas</span>
              </div>
            </a>
          );
        })}
      </div>
    ) : (
      <div class="empty-state">
        <div class="empty-icon">N</div>
        <h3>No hay articulos disponibles</h3>
        <p>Actualmente no tenemos articulos publicados.</p>
        <p class="empty-hint">Los articulos apareceran aqui cuando esten disponibles.</p>
      </div>
    )}

    {articulos.length > 0 && (
      <div class="articles-count">
        <span>Mostrando {articulos.length} articulo{articulos.length !== 1 ? 's' : ''}</span>
      </div>
    )}
  </div>
</section>

<style>
  .article-grid-section {
    padding: 4rem 2rem;
    background: var(--background-color, #f8f9fa);
  }

  .article-grid-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .section-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .section-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-color, #1a202c);
    margin: 0 0 0.5rem 0;
  }

  .section-subtitle {
    font-size: 1.1rem;
    color: var(--text-secondary, #718096);
    margin: 0;
  }

  .articles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .article-card {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    flex-direction: column;
  }

  .article-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  }

  .article-card.featured {
    grid-column: span 2;
  }

  .article-card.featured .article-image {
    height: 300px;
  }

  .article-image {
    position: relative;
    height: 200px;
    background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
  }

  .article-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .no-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #a0aec0;
    font-size: 3rem;
    font-weight: bold;
  }

  .placeholder-icon {
    font-size: 3rem;
    opacity: 0.5;
  }

  .article-category {
    position: absolute;
    top: 1rem;
    left: 1rem;
    padding: 0.25rem 0.75rem;
    background: var(--primary);
    color: white;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .article-content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  .article-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
    font-size: 0.85rem;
    color: var(--text-secondary, #718096);
  }

  .article-date,
  .article-author {
    display: inline;
  }

  .article-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-color, #1a202c);
    margin: 0 0 0.75rem 0;
    line-height: 1.3;
  }

  .article-card.featured .article-title {
    font-size: 1.5rem;
  }

  .article-excerpt {
    font-size: 0.95rem;
    color: var(--text-secondary, #718096);
    margin: 0 0 1rem 0;
    line-height: 1.6;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .read-more {
    display: inline-block;
    color: var(--primary);
    font-weight: 500;
    font-size: 0.9rem;
    margin-top: auto;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    color: #a0aec0;
  }

  .empty-state h3 {
    font-size: 1.5rem;
    color: var(--text-color, #1a202c);
    margin: 0 0 0.5rem 0;
  }

  .empty-state p {
    color: var(--text-secondary, #718096);
    margin: 0 0 0.5rem 0;
  }

  .empty-hint {
    font-size: 0.9rem;
    color: #a0aec0;
    font-style: italic;
  }

  .articles-count {
    margin-top: 2rem;
    text-align: center;
    font-size: 0.9rem;
    color: #718096;
  }

  @media (max-width: 768px) {
    .article-grid-section {
      padding: 2rem 1rem;
    }

    .section-title {
      font-size: 1.5rem;
    }

    .articles-grid {
      grid-template-columns: 1fr;
    }

    .article-card.featured {
      grid-column: span 1;
    }

    .article-card.featured .article-image {
      height: 200px;
    }

    .article-card.featured .article-title {
      font-size: 1.25rem;
    }
  }
</style>
